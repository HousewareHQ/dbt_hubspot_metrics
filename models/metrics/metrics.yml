version: 2
metrics:
  - name: hubspot__weekly_email_delivered_events
    label: Weekly Email Delivered Events
    model: ref('hubspot__email_events')
    description: "Weekly number of email delivered events."
    type: count
    sql: event_id
    timestamp: created_timestamp
    time_grains: [week]
    filters:
      - field: event_type
        operator: "="
        value: "'DELIVERED'"
    dimensions: []

  - name: hubspot__weekly_email_open_events
    label: Weekly Email Open Events
    model: ref('hubspot__email_events')
    description: "Weekly number of email open events."
    type: count_distinct
    sql: sent_by_event_id
    timestamp: created_timestamp
    time_grains: [week]
    filters:
      - field: event_type
        operator: "="
        value: "'OPEN'"
    dimensions: []

  - name: hubspot__weekly_email_sent_events
    label: Weekly Email Sent Events
    model: ref('hubspot__email_events')
    description: "Weekly number of email sent events."
    type: count
    sql: event_id
    timestamp: created_timestamp
    time_grains: [week]
    filters:
      - field: event_type
        operator: "="
        value: "'SENT'"
    dimensions: []

  - name: hubspot__weekly_email_open_rate
    label: Weekly Email Open Rate
    description: "Weekly number of emails open events out of emails sent"
    type: expression
    sql: "{{metric('hubspot__weekly_email_open_events')}} * 100 / {{metric('hubspot__weekly_email_sent_events')}}"
    time_grains: [week]
    dimensions: []
